package com.dhc.jstestdemo.launchmodetest;

import android.app.Activity;
import android.content.Intent;
import android.content.pm.PackageManager;
import android.content.pm.ResolveInfo;
import android.net.Uri;
import android.os.Bundle;
import android.support.annotation.Nullable;
import android.util.Log;
import android.view.View;
import android.widget.Button;
import android.widget.Toast;

import com.dhc.jstestdemo.R;
import com.dhc.jstestdemo.ipc.fileshare.Book;
import com.dhc.jstestdemo.ipc.fileshare.SaveAndGetBookInfo;
import com.dhc.jstestdemo.ipc.messenger.MessengerActivity;

import java.util.List;

/**
 * 指定一个任务栈
 * com.dhc.jestdemo1
 * Created by 大漠dreamer on 2019/3/11.
 */

public class ActivityA extends Activity {

    Button btLaunchB;
    Button btLaunchC;

    Button btLaunchFilter;

    @Override
    protected void onCreate(@Nullable Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_a);
        btLaunchB = findViewById(R.id.button_launch_b);
        btLaunchB.setText("跳转到B"+"\n"+"试试换行");
        btLaunchC = findViewById(R.id.button_launch_c);
        btLaunchFilter = findViewById(R.id.button_launch_intent_filter);
        btLaunchB.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View v) {
                Intent intent = new Intent(ActivityA.this, ActivityB.class);
                intent.setFlags(Intent.FLAG_ACTIVITY_NEW_TASK);
                startActivity(intent);
            }
        });
        btLaunchC.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View v) {
                Intent intent = new Intent(ActivityA.this, MessengerActivity.class);
                startActivity(intent);
            }
        });

        final Bundle bundle = new Bundle();
//        bundle.putSparseParcelableArray("test", SparseArray<Strbing> list);
        byte a = '1';
        bundle.putByte("1", a);


        btLaunchFilter.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View v) {
//                Intent intent = new Intent("com.dhc.intent_action_1");
                Intent intent = new Intent();
//                intent.putExtra("test", bundle);
                //TODO action必须要正确匹配
                intent.setAction("com.dhc.intent_action_2");
//                intent.setAction("com.dhc.intent_action_3");
//                intent.addCategory("com.dhc.category_1");
                //TODO category必须要正确匹配
                intent.addCategory("com.dhc.category_2");
//                intent.addCategory("com.dhc.category_3");
//                intent.setDataAndType(Uri.parse("content://abc"), "text/plain");
                intent.setDataAndType(Uri.parse("file://abd"), "text/plain");
                intent.setDataAndType(Uri.parse("xxxx://abd"), "text/plain");
                //TODO data只需要匹配上一个就行
                intent.setDataAndType(Uri.parse("http://abc"), "video/mpeg");

                //TODO 三种方式检验匹配规则，是否存在Activity
                PackageManager pm = getPackageManager();

                //TODO 此方法OK
                List<ResolveInfo> list = pm.queryIntentActivities(intent, PackageManager.MATCH_DEFAULT_ONLY);
                if (list.size() != 0) {
                    startActivity(intent);
                } else {
                    Toast.makeText(ActivityA.this, "没有找到对应的Activity", Toast.LENGTH_SHORT).show();
                }
                //TODO 此方法OK
//                ResolveInfo resolveInfo = pm.resolveActivity(intent, PackageManager.MATCH_DEFAULT_ONLY);
//                if (resolveInfo != null) {
//                    startActivity(intent);
//                } else {
//                    Toast.makeText(ActivityA.this, "没有找到对应的Activity", Toast.LENGTH_SHORT).show();
//                }
                //TODO 此方法OK
//                ComponentName name = intent.resolveActivity(pm);
//                if (name != null) {
//                    startActivity(intent);
//                } else {
//                    Toast.makeText(ActivityA.this, "没有找到对应的Activity", Toast.LENGTH_SHORT).show();
//                }
            }
        });

        savebook();
    }

    private void savebook() {
        Book book = new Book("计算机网络原理", "james E Kurose");
        SaveAndGetBookInfo.saveBookInfo(book);

    }

}
